<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{player.player_name}}_詳細</title>
</head>

<body>
    <header>
    <a href="{% url 'player_app:player_csv' player.uniform_number %}">詳細のダウンロードはこちら</a>
    </header>

    <main>
    <div class="card">
    <h2>選手詳細</h2>
    <table class="status">
        <tr>
            <th>背番号</th><th>氏名</th><th>生年月日</th><th>ポジション</th><th>利き手</th>
        </tr>
        <tr>
            <td>{{ player.uniform_number|default:0 }}</td>
            <td>{{ player.player_name|default:0 }}</td>
            <td>{{ player.birthday|date:"Y年n月j日" }}</td>
            <td>{{ player.position|default:0 }}</td>
            <td>{{ player.throwing_hand|default:"" }}投げ{{ player.batting_hand|default:0 }}打ち</td>
        </tr>
    </table>
    </div>

    {% if batting %}
    <div class="card">
    <h2>打撃詳細</h2>
    <table class="status">
        <tr>
            <th>試合数</th><th>打席</th><th>打数</th><th>安打</th><th>二塁打</th><th>三塁打</th>
            <th>本塁打</th><th>得点</th><th>打点</th><th>犠打</th><th>犠飛</th><th>四球</th><th>死球</th>
            <th>三振</th><th>併殺</th>
        </tr>
        <tr>
            <td>{{ batting.games|default:0 }}</td>
            <td>{{ batting.numPlate|default:0  }}</td>
            <td>{{ batting.numBat|default:0  }}</td>
            <td>{{ batting.hits|default:0  }}</td>
            <td>{{ batting.hit2nd|default:0 }}</td>
            <td>{{ batting.hit3rd|default:0 }}</td>
            <td>{{ batting.homeruns|default:0  }}</td>
            <td>{{ batting.points|default:0  }}</td>
            <td>{{ batting.getpoint|default:0  }}</td>
            <td>{{ batting.bants|default:0 }}</td>
            <td>{{ batting.sacFry|default:0 }}</td>
            <td>{{ batting.fourballs|default:0  }}</td>
            <td>{{ batting.deadballs|default:0 }}</td>
            <td>{{ batting.strikeOut|default:0  }}</td>
            <td>{{ batting.doublePlay|default:0 }}</td>
        </tr>
    </table>    
    </div>

    <div class="card">
    <h2>守備・走塁成績</h2>
    <table class="status_small">
        <tr>
            <th>盗塁数</th><th>盗塁死</th><th>失策</th>
        </tr>
        <tr>
            <td>{{ batting.steal|default:0 }}</td>
            <td>{{ batting.missedSteal|default:0 }}</td>
            <td>{{ batting.errors|default:0 }}</td>
        </tr>
    </table>    
    </div>

    <div class="card">
    <h2>打者指標 ({{player.player_name}})</h2>
    <table class="status">
        <tr>
            <th>指標名</th><th>数値</th><th>説明</th><th>計算式</th><th>優秀</th><th>非常に優秀</th>
        </tr>
        <tr>
            <td>打率 (AVG)</td>
            <td>{{ metrics.AVG }}</td>
            <td>打者が打席でヒットを打つ確率。高いほど良い。</td>
            <td>安打 ÷ 打数</td>
            <td>.270</td>
            <td>.290</td>
        </tr>
        <tr>
            <td>出塁率 (OBP)</td>
            <td>{{ metrics.OBP }}</td>
            <td>打者が出塁できる確率（ヒット・四球・死球を含む）。高いほど良い。</td>
            <td>(安打 + 四球 + 死球) ÷ 打席</td>
            <td>.330</td>
            <td>.390</td>
        </tr>
        <tr>
            <td>長打率 (SLG)</td>
            <td>{{ metrics.SLG }}</td>
            <td>打者の長打力を示す指標。高いほど良い。</td>
            <td>(単打 + 2×二塁打 + 3×三塁打 + 4×本塁打) ÷ 打数</td>
            <td>.450</td>
            <td>.550</td>
        </tr>
        <tr>
            <td>OPS</td>
            <td>{{ metrics.OPS }}</td>
            <td>出塁率と長打率を合計した総合打撃力。高いほど良い。</td>
            <td>OBP + SLG</td>
            <td>.730</td>
            <td>1.000</td>
        </tr>
        <tr>
            <td>純長打率 (IsoP)</td>
            <td>{{ metrics.IsoP }}</td>
            <td>純粋な長打の割合（単打の影響を除く）。高いほど良い。</td>
            <td>SLG - AVG</td>
            <td>.150</td>
            <td>.250</td>
        </tr>
        <tr>
            <td>三振率 (SO%)</td>
            <td>{{ metrics.SO_percent }}</td>
            <td>打席に対する三振の割合。低いほど良い。</td>
            <td>三振 ÷ 打席</td>
            <td>.150</td>
            <td>.100</td>
        </tr>
        <tr>
            <td>四球率 (BB%)</td>
            <td>{{ metrics.BB_percent }}</td>
            <td>打席に対する四球の割合。高いほど良い。</td>
            <td>四球 ÷ 打席</td>
            <td>.120</td>
            <td>.150</td>
        </tr>
        <tr>
            <td>四球/三振 (BB/SO)</td>
            <td>{{ metrics.BB_per_SO }}</td>
            <td>三振数と四球数の比率。高いほど良い。</td>
            <td>四球 ÷ 三振</td>
            <td>1.30</td>
            <td>1.50</td>
        </tr>
        <tr>
            <td>得点効率 (R/PA)</td>
            <td>{{ metrics.R_per_PA }}</td>
            <td>打席あたりの得点期待値。高いほど良い。</td>
            <td>得点 ÷ 打席</td>
            <td>.150</td>
            <td>.180</td>
        </tr>
        <tr>
            <td>打点効率 (RBI/PA)</td>
            <td>{{ metrics.RBI_per_PA }}</td>
            <td>打席あたりの打点期待値。高いほど良い。</td>
            <td>打点 ÷ 打席</td>
            <td>.120</td>
            <td>.150</td>
        </tr>
    </table>
    </div>


    {% endif %}

    {% if pitching %}
    <div class="card">
    <h2>投球成績</h2>
    <table class="status">
        <tr>
            <th>登板数</th><th>投球回</th><th>勝敗</th><th>ホールド</th><th>HP</th><th>セーブ</th>
            <th>防御率</th><th>完投</th><th>完封</th><th>QS</th><th>対戦打者数</th><th>三振</th>
            <th>被安打</th><th>被本塁打</th><th>与四球</th><th>与死球</th><th>敬遠</th><th>無四球</th>
            <th>暴投</th><th>ボーク</th><th>失点</th><th>自責点</th>
        </tr>
        <tr>
            <td>{{ pitching.games|default:0  }}</td>
            <td>{{ pitching.ining|default:0  }}</td>
            <td>{{ pitching.win|default:0  }}勝{{ pitching.lose|default:0  }}敗</td>
            <td>{{ pitching.hold|default:0  }}</td>
            <td>{{ pitching.HP|default:0  }}</td>
            <td>{{ pitching.saves|default:0  }}</td>
            <td>{{ pitching.ERA|default:0  }}</td>
            <td>{{ pitching.fullIning|default:0  }}</td>
            <td>{{ pitching.perfect|default:0  }}</td>
            <td>{{ pitching.QS|default:0  }}</td>
            <td>{{ pitching.batter|default:0  }}</td>
            <td>{{ pitching.strikeOut|default:0  }}</td>
            <td>{{ pitching.hit|default:0  }}</td>
            <td>{{ pitching.homerun|default:0  }}</td>
            <td>{{ pitching.fourball|default:0  }}</td>
            <td>{{ pitching.deadBall|default:0  }}</td>
            <td>{{ pitching.int_walk|default:0  }}</td>
            <td>{{ pitching.noFour|default:0  }}</td>
            <td>{{ pitching.wildPitch|default:0  }}</td>
            <td>{{ pitching.balk|default:0  }}</td>
            <td>{{ pitching.lostScore|default:0  }}</td>
            <td>{{ pitching.earnedRun|default:0  }}</td>
        </tr>
    </table>
    
    </div>

    <div class="card">
    <h2>投手指標 ({{player.player_name}})</h2>
    <table class="status">
        <tr>
            <th>指標名</th><th>数値</th><th>説明</th><th>計算式</th><th>優秀</th><th>非常に優秀</th>
        </tr>
        <tr>
            <td>勝率 (Win%)</td>
            <td>{{ metrics.win_percent }}</td>
            <td>責任投手になった試合における勝利確率。高いほど良い。</td>
            <td>勝利 ÷ (勝利 + 敗北)</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>K/9</td>
            <td>{{ metrics.K_per_9 }}</td>
            <td>9イニングあたりの奪三振数。高いほど良い。</td>
            <td>三振 × 9 ÷ 投球回</td>
            <td>9.5</td>
            <td>10.5</td>
        </tr>
        <tr>
            <td>BB/9</td>
            <td>{{ metrics.BB_per_9 }}</td>
            <td>9イニングあたりの与四球数。低いほど良い。</td>
            <td>四球 × 9 ÷ 投球回</td>
            <td>2.25</td>
            <td>1.5</td>
        </tr>
        <tr>
            <td>K/BB</td>
            <td>{{ metrics.K_per_BB }}</td>
            <td>奪三振と与四球数の比率。高いほど良い。</td>
            <td>三振 ÷ 四球</td>
            <td>4.0</td>
            <td>5.0</td>
        </tr>
        <tr>
            <td>与四死球率 (BB+HBP/9)</td>
            <td>{{ metrics.BB_plus_HBP_per_9 }}</td>
            <td>9イニングあたりの与四球と与死球の合計。低いほど良い。</td>
            <td>(四球 + 死球) × 9 ÷ 投球回</td>
            <td>2.5</td>
            <td>1.75</td>
        </tr>
        <tr>
            <td>被打率 (BAA)</td>
            <td>{{ metrics.BAA }}</td>
            <td>打者に安打を許した割合。低いほど良い。</td>
            <td>被安打 ÷ 対戦打者数</td>
            <td>.240</td>
            <td>.200</td>
        </tr>
        <tr>
            <td>HR/9</td>
            <td>{{ metrics.HR_per_9 }}</td>
            <td>9イニングあたりの被本塁打数。低いほど良い。</td>
            <td>被本塁打 × 9 ÷ 投球回</td>
            <td>1.5</td>
            <td>0.2</td>
        </tr>
        <tr>
            <td>WHIP</td>
            <td>{{ metrics.WHIP }}</td>
            <td>1イニングあたりの平均走者数（四球+被安打）。低いほど良い。</td>
            <td>(四球 + 被安打) ÷ 投球回</td>
            <td>1.10</td>
            <td>1.00</td>
        </tr>
    </table>
    </div>
    {% endif %}

    <p><a href="{% url 'player_app:search'%}">TOPへ戻る</a></p>
    </main>
</body>
</html>
<style>
ul {
    list-style-type: none;       
}

table.status {
    border-collapse: collapse; 
    width: 100%;
}

table.status th,
table.status td {
    border: 1px solid black;   
    padding: 5px;              
    text-align: center;        
}

table.status_small {
    border-collapse: collapse; 
    width: 75%;
    margin: 0 auto;
}

table.status_small th,
table.status_small td {
    border: 1px solid black;   
    padding: 5px;              
    text-align: center;      
}

.card {
    border: 1px solid #ccc;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
    background-color: #fffaf2ff;
    }
    
</style>